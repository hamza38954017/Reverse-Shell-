name: Build Windows Application

on:
  push:
    branches: [ "main" ]
  workflow_dispatch:

jobs:
  build:
    runs-on: windows-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v3

    # --- ADD THIS STEP ---
    - name: Setup MSVC Environment
      uses: ilammy/msvc-dev-cmd@v1
    # ---------------------

    - name: Display system info
      run: |
        echo "System Info:"
        systeminfo | findstr /B /C:"OS Name" /C:"OS Version"
        echo "Compiler version:"
        cl.exe
      # Note: This step will now work because the previous step added cl.exe to the path.

    - name: Compile with MSVC
      run: |
        cl.exe /EHsc /Fe:lab_practice_v3.exe main.cpp /link /SUBSYSTEM:WINDOWS
      shell: cmd

    - name: Verify compilation
      run: |
        dir *.exe
        echo "Checking if executable was created..."
        if exist lab_practice_v3.exe (echo SUCCESS: Executable created!) else (echo ERROR: Executable not found!)
      shell: cmd 
      # Added shell: cmd here for consistency with the Windows 'if' syntax

    - name: Upload Artifact
      uses: actions/upload-artifact@v4
      with:
        name: Windows-Executable
        path: lab_practice_v3.exe
        if-no-files-found: error
