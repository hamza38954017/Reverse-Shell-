name: Build Windows Application

on:
  push:
    branches: [ "main" ]
  workflow_dispatch:

jobs:
  build:
    runs-on: windows-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v3

    # Setup the environment so cl.exe is found
    - name: Setup MSVC Environment
      uses: ilammy/msvc-dev-cmd@v1

    - name: Display system info
      run: |
        echo "System Info:"
        systeminfo | findstr /B /C:"OS Name" /C:"OS Version"
        echo "Compiler version:"
        cl.exe
      shell: cmd

    # UPDATED STEP: Added gdi32.lib, ole32.lib, and oleaut32.lib to the command
    - name: Compile with MSVC
      run: |
        cl.exe /std:c++17 /EHsc main.cpp /Fe:lab_practice_v3.exe /link /SUBSYSTEM:WINDOWS wininet.lib ws2_32.lib advapi32.lib user32.lib gdi32.lib ole32.lib oleaut32.lib
      shell: cmd

    - name: Verify compilation
      run: |
        dir *.exe
        echo "Checking if executable was created..."
        if exist lab_practice_v3.exe (echo SUCCESS: Executable created!) else (echo ERROR: Executable not found!)
      shell: cmd

    - name: Upload Artifact
      uses: actions/upload-artifact@v4
      with:
        name: Windows-Executable
        path: lab_practice_v3.exe
        if-no-files-found: error
